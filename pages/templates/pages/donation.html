{% extends 'base.html' %} {% block title %} Make a Donation {% endblock title %} {% block content %}
<!-- mobile menu style end -->
<main>
  <!-- donation details breadcrumb start -->
  <div class="wrapper-box p-relative">
    <div class="breadcrumb-bg" data-background="https://res.cloudinary.com/dav4wpgc9/image/upload/v1691754700/website/assets/img/breadcrumb/breadcrumb-bg_bwimw6.png"></div>
    <div class="breadcrumb-area pt-265 pb-265">
      <div class="container">
        <div class="row">
          <div class="col-xl-12">
            <div class="breadcrumb__content text-center">
              <h1 class="breadcrumb__title">Donate</h1>
              {% comment %}
              <div class="breadcrumb__list">
                <span><a href="index.html">Home</a></span>
                <span class="dvdr"><i class="fa-solid fa-colon"></i></span>
                <span class="underline">Campains details</span>
              </div>
              {% endcomment %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- donation details breadcrumb end -->

  <!-- donation details area start -->
  <div class="donation-details-area pt-100 pb-90">
    <div class="container">
      <div class="row">
        <div class="col-lg-6 mx-auto">
          <div class="right-padding pl-25">
            <div class="sidebar__widget-contact">
              <h3 class="sidebar__widget-title donation-details contact">Make a Donation</h3>
              <form action="" id="paymentForm">
                {% csrf_token %}
                <input type="text" placeholder="Enter name*" name="sender" id="sender" />
                <input type="email" placeholder="Enter your e-mail" name="email" id="email" />
                <input type="hidden" name="ref" value="123456789011" id="ref" />
                <input type="number" placeholder="Amount (min. amount = NGN 500)*" name="amount" id="amount" min="500" />
                <div class="sidebar-btn">
                  <button class="tp-btn tp-btn-shine-effect" onclick="payWithPaystack()">Donate Now</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Blog details area end -->

  <script src="https://js.paystack.co/v1/inline.js"></script>
  <script>
    const paymentForm = document.getElementById("paymentForm");
    paymentForm.addEventListener("submit", payWithPaystack, false);

    function payWithPaystack(e) {
      e.preventDefault();

      let handler = PaystackPop.setup({
        key: "pk_test_52da50fc9e8aad372d09804591b184bf5e0764ce", // Replace with your public key
        sender: document.getElementById("sender").value,
        email: document.getElementById("email").value,
        amount: document.getElementById("amount").value * 100,
        // ref: document.getElementById("ref").value, 
        ref: ''+Math.floor((Math.random() * 1000000000) + 1),// generates a pseudo-unique reference. Please replace with a reference you generated. Or remove the line entirely so our API will generate one for you
        // label: "Optional string that replaces customer email"
        onClose: function () {
          alert("Payment window closed.");
        },
        callback: function (response) {
            const url = "{% url 'donation' %}";
            let csrftoken = "{{csrf_token}}";
            // Note: Depending on your API this may need to be different
            let data = new URLSearchParams();
            data.append(`ref`, `${response.reference}`);
            data.append(`sender`, `${sender.value}`);
            data.append(`status`, `${response.status}`);
            data.append(`email`, `${email.value}`);
            data.append(`amount`, `${amount.value}`);
            data.append(`tx_ref`, `${response.transaction}`);

            const options = {
                method: `POST`,
                body: data,
                headers: {
                    "X-CSRFToken": csrftoken,
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
            };

            fetch(url, options)
            .then(data => {
                if (!data.ok) {
                // see catch below
                throw data;
                }
                someSuccessFunction(data);
            })
            // catch any error in the network call.
            .catch(error => {
                someErrorFunction(error);
            });
        },
      });

      handler.openIframe();
    }
  </script>
</main>
{% endblock content %}
